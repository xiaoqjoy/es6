<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="../../files/css/bootstrap.css">
    <link rel="stylesheet" href="../../files/css/font-awesome.min.css">
    <link rel="stylesheet" href="../../files/css/simple-line-icons.css">
    <link rel="stylesheet" href="../../files/css/app.css">
    <link rel="stylesheet" href="../../files/css/paltstyle.css">
    <title>Title</title>
</head>
<body style="background: none;">
<div class="widget-box profileBox">
    <div class="widget-title"> <span class="icon"><i class="glyphicon glyphicon-th"></i></span>
        <h5>关于我们-管理团队</h5>
    </div>
    <div class="widget-content ">
        <div class="content">
            <h4>文字编辑</h4>
            <div class="text panel" id="text_panel">
            <!--     中国第三代小微贷款技术的开创者，出色的风控管理能力 -->
            </div>
            <button class="btn btn-info edit-btn">编辑</button>
        </div>

        <div class="edit-profile" style="display: none;">
            <h4>文字编辑</h4>
            <div>
                <iframe src="../../wysiwyg.html" id="content" frameborder="0" width="1000px" height="400px"></iframe>
            </div>
            <button class="save-btn btn btn-info">保存</button>
        </div>

        <hr>
        <div class="img-block">
            <h4>图片编辑</h4>
            <img src="" id="image">
            <div class="operation">
                <button id="uploadBtn" class="btn btn-info pull-right">上传</button>
                <form id="tf">
                <div class="file-panel">
                    <input id="bannerInput" type="text" class="file-input" disabled placeholder="选择图片（图片宽度为1170px,后缀jpg格式）">
                    <div class="file-box">
                        <input type="file" class="file" id="files" name="image" onchange="fileChange(this)">
                    </div>
                </div>
                </form>
            </div>

            <div class="clearfix"></div>
        </div>
    </div>

</div>

<script src="../../files/js/jquery.min.js"></script>
<script src="../../files/js/bootstrap.js"></script>
<script src="../../files/layer/layer.js"></script>
<script src="../../files/js/comment.js"></script>
<script>

	var content = '';
	var contains = false;
	var serailNo = '';

	$(function(){
		loadGrid();
	});
	
    $(function(){
        $('.edit-btn').click(function () {
            $('.edit-profile').show();
            document.getElementById("content").contentWindow.document.getElementById("editor").innerHTML= $('.content .text').html();
            $('.content').hide();
        });
    });

    $('.save-btn').click(function () {
        $('.edit-profile').hide();
        $('.content').show();
        $('.content .text').html(document.getElementById("content").contentWindow.document.getElementById('editor').innerHTML);
        content = document.getElementById("content").contentWindow.document.getElementById('editor').innerHTML;
        var imageSrc = $("#image").attr("src");
        //console.log(content + '-' +imageSrc);
        var pos = {'status': '2','textDesc': content,'imageSrc':imageSrc};
        if(contains){
        	upData(pos, serailNo);
        } else {
        	addData(pos);
        }
    })

    
	function loadGrid() {
		$.ajax({
			type : "POST",
			url : "/api/DsWebsit/getDatas.do",
			data : {
				type : "about.team",
				page : "0",
				size : "1"
			},
			dataType : "json",
			success : function(jsonResult) {
				if (jsonResult.code == "0000" && jsonResult.data.length == 1) {
					$("#text_panel").html(jsonResult.data[0].textDesc);
					$("#image").attr("src", jsonResult.data[0].imageSrc); 
					contains = true;
					serailNo = jsonResult.data[0].baseNo;
				} else {
					$("#text_panel").html("");
					contains = false;
					serailNo = '';
					
				}
			},
			error : function(XMLHttpRequest, textStatus, errorThrown) {
				layer.msg("系统异常，请稍后再试！");
			}
		});
	}
    
    $(function(){
        $('#uploadBtn').click(function () {
        	if(isEmpty($("#bannerInput").val())){
        		return;
        	}
            layer.confirm('确定修改管理团队的图片吗？',{
                btn:['Y','N']
            },function(){
        		var form = new FormData(document.getElementById("tf"));
        		$.ajax({
        		    url:"/api/uploadImageLocal.do",
        		    type:"POST",
        		    data: form,
        		  
        		    processData: false,  // 告诉jQuery不要去处理发送的数据
        		    contentType: false,  // 告诉jQuery不要去设置Content-Type请求头
        		    success:function(jsonResult){
        		    	if(!isEmpty(jsonResult) && jsonResult.code == '0000'){
        		            content = $("#text_panel").html();
        		            $("#bannerInput").val("");
        		    		var pos = {'status': '2', 'imageSrc': jsonResult.data, 'textDesc': content};
        		    		if(contains){
        		            	upData(pos, serailNo);
        		            } else {
        		            	addData(pos);
        		            }
        		    	} 
       		    		layer.close(layer.index);
       		    		layer.msg(jsonResult.data);
           			},
           			error: function(XMLHttpRequest, textStatus, errorThrown) {
           				layer.close(layer.index);
        				layer.msg("系统异常，请稍后再试！");
                    }
        		});
            })
            
        });
    });

 	function addData(pos){
    	$.ajax({
			type : "POST",
			url : "/api/DsWebsit/addData.do",
			dataType : "json",
			data : {
				"pos":JSON.stringify(pos),
				type : 'about.team'
			},
			success : function(jsonResult) {
				layer.msg(jsonResult.message);
				loadGrid();
			},
			error: function(XMLHttpRequest, textStatus, errorThrown) {
				layer.msg("系统异常，请稍后再试！");
            }
		});
    }	
    
    function upData(pos,serailNo){
    	$.ajax({
			type : "POST",
			url : "/api/DsWebsit/upData.do",
			dataType : "json",
			data : {
				"pos":JSON.stringify(pos),
				type : 'about.team',
				serailNo : serailNo
			},
			success : function(jsonResult) {
				layer.msg(jsonResult.message);
				loadGrid();
			},
			error: function(XMLHttpRequest, textStatus, errorThrown) {
				layer.msg("系统异常，请稍后再试！");
            }
		});
    }
</script>
</body>
</html>