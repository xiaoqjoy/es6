<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
    <link rel="stylesheet" href="../../files/css/bootstrap.css">
    <link rel="stylesheet" href="../../files/css/font-awesome.min.css">
    <link rel="stylesheet" href="../../files/css/simple-line-icons.css">
    <link rel="stylesheet" href="../../files/css/app.css">
    <link rel="stylesheet" href="../../files/css/paltstyle.css">
    <title>Title</title>
</head>
<body style="background: none;">


<div class="widget-box">
    <div class="widget-title"> <span class="icon"><i class="glyphicon glyphicon-th"></i></span>
        <h5>滚动广播</h5>
    </div>
    <div class="widget-content ">
        <div class="operation text-right">
            <button id="create-btn" class="btn btn-info l-s-2x">新增</button>
        </div>
        <table class="table data-table table-bordered">
            <thead>
            <tr>
                <th style="display: none">ID编号</th>
                <th>信息正文</th>
                <th style="width: 80px;">排序操作</th>
                <th style="width: 80px;">排序号</th>
                <th style="width: 80px;">显示状态</th>
                <th  style="width: 100px;">创建时间</th>
                <th  style="width: 100px;">操作</th>
                
            </tr>
            </thead>
            <tbody id="list">
            </tbody>
        </table>

        <div class="text-right">
            <ul class="pagination pagination-sm">
            </ul>
        </div>

    </div>

</div>

<script src="../../files/js/jquery.min.js"></script>
<script src="../../files/js/bootstrap.js"></script>
<script src="../../files/layer/layer.js"></script>
<script>
	function loadData(size,onPage){
    	var pageNumber = 0;
		$.ajax({
            type:'post',
            dataType:'json',
            url : '../../api/newsManagerSystem/findNewsInfo.do',
            data: {
                'page':onPage,
                'size':size,
                'moduleFlag':'1'
            },
            success : function(rtnData){
            	if(rtnData.code=="00"){
            		pageNumber = Math.ceil(rtnData.data['total']/size);
            		setList(rtnData.data['newsMsgs'],onPage,pageNumber);
            		
            		page(pageNumber,onPage);
            	}
            }
        });
	}


    $(function(){
    	loadData(10,0);
       $('#create-btn').click(function(){
           layer.open({
               title:'新增滚动喇叭',
               type: 2,
               area: ['960px', '500px'],
               fixed: false, //不固定
               maxmin: true,
               content: 'createBroad.html'
           });
       });
        $('.edit-btn').click(function(){
        	
        });
    });
    
    function editData(id){
          layer.open({
             title:'编辑喇叭',
             type: 2,
             area: ['960px', '500px'],
             fixed: false, //不固定
             maxmin: true,
             content: 'createBroad.html?id=' + id
         });
    }
    
    function deleteData(id){
    	layer.confirm('确定删除该条滚动喇叭吗？',{
            btn:['Y','N']
        },function(){
        	$.ajax({
                type:'post',
                dataType:'json',
                url : '../../api/newsManagerSystem/deleteNewsMsg.do',
                data:{"id":id}, 
                success : function(rtnData){
                	if(rtnData.code=="00"){
                		window.location.reload();
                	}
                }
            });
           
        })
    }

    
    function sortDown(othis){
    	if($(othis).hasClass('disable')){
            return ;
        }else{
            var numDown =  $(othis).parents('tr').find('.sort-num').text();
            var numUp = $(othis).parents("tr").next("tr").find(".sort-num").text();
              setSorting(numDown,numUp,$(othis),"down");
        }
    }
    
    function sortUp(othis){
    	if($(othis).hasClass('disable')){
            return ;
        }else{
            var numUp =   $(othis).parents('tr').find('.sort-num').text();
            var numDown= $(othis).parents("tr").prev("tr").find(".sort-num").text();
              setSorting(numDown,numUp,$(othis),"up");
        }
    }
    
    function setSorting(numDown,numUp,othis,flag){
        var pos = {'moduleFlag': '1','sorting': numDown+"31415"+numUp};
    	$.ajax({
            type:'post',
            dataType:'json',
            url : '../../api/newsManagerSystem/insertNewsMsg.do',
            data:{"pos":JSON.stringify(pos),"flag":flag}, 
            
            success : function(rtnData){
            	if(rtnData.code=="00"){
            		window.location.reload();
            	}
            }
        });
    	
    }
    
    $(document).on('click','.pagination a',function(){
    	  var onPage = $(this).text()-1;
          loadData(10,onPage);
    });

    function closeLayer(){
        layer.closeAll();
    }
    
    function page(totalPage,onPage){
    	$('.pagination').empty();
        if(onPage==0){
            $('.pagination').append('<li class="disabled "><a href="#">&laquo;</a></li>');
        }else{
            $('.pagination').append('<li class="prev"><a href="#">&laquo;</a></li>');
        }

        for (var i=0;i<totalPage;i++){
            if(i==(onPage)){
                $('.pagination').append('<li class="active"><a href="#">'+ (i+1) +'</a></li>');
            }else{
                $('.pagination').append('<li><a>'+ (i+1) +'</a></li>');
            }

        }

        if(onPage==(totalPage-1)){
            $('.pagination').append('<li class="disabled"><a href="#">&raquo;</a></li>');
        }else{
            $('.pagination').append('<li class="next"><a href="#">&raquo;</a></li>');
        }

    }
    
    function setList(data,onPage,pageNumber){
    	$('#list').empty();
    	var disableUp = '', disableDown = '';
        for(var i=0;i<data.length;i++){
        	if(onPage==0 && i==0){
        		disableUp = 'disable';
        	}else{
        		disableUp = '';
        	}
        	if(onPage==(pageNumber-1) && i==data.length-1){
                disableDown =  'disable';
            }else{
                disableDown = '';
            }
            $('#list').append(' <tr> <td style="display: none;"><span class="IDcode">'+
                    data[i].id +'</span></td> ' +
                    '<td>'+  data[i].msgContent +'</td> ' +
                    '<td><a class="sort-up sort '+ disableUp +'" href="javascript:void(0)" onclick="sortUp(this)"><i class="glyphicon glyphicon-arrow-up"></i></a> ' +
                    '<a class="sort-down sort '+ disableDown +'"  href="javascript:void(0)" onclick="sortDown(this)"><i class="glyphicon glyphicon-arrow-down"></i></a></td> ' +
                    '<td "><span class="sort-num">'+  data[i].sorting +'</span></td> ' +
                    '<td>'+  data[i].isVisible +'</td> ' +
                    '<td>'+  data[i].releaseTime +'</td> ' +
                    '<td><a class="edit-btn" onclick="editData('+data[i].id+')" href="javascript:void(0)">编辑</a> ' +
                    '<a class="delete-btn" onclick="deleteData('+data[i].id+')" href="javascript:void(0)">删除</a></td> </tr>')
        }

    }
    
   

</script>
</body>
</html>