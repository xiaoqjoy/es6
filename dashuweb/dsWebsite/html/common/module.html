<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<link rel="stylesheet" href="../../files/css/bootstrap.css">
		<link rel="stylesheet" href="../../files/css/font-awesome.min.css">
		<link rel="stylesheet" href="../../files/css/simple-line-icons.css">
		<link rel="stylesheet" href="../../files/css/app.css">
		<link rel="stylesheet" href="../../files/css/paltstyle.css">
		<title>Title</title>
	</head>
	<body style="background: none;">
		<div class="widget-box bannerBox">
			<div class="widget-title"> <span class="icon"><i class="glyphicon glyphicon-th"></i></span>
				<h5 id="headTxt"></h5>
			</div>
			<div class="form-horizontal">

				<div class="double-input" style="margin-top:20px">

				</div>
				<div class="l input-groups">
					<label>标题：</label>
					<input id="title" type="text" class="title">
				</div>
				<div class="l input-groups">
					<label>子标题：</label>
					<input id="subTitle" type="text" class="subTitle">
				</div>
				<div class="l input-groups">
					<label>内容：</label>
					<textarea id="baseContent"></textarea>
				</div>
				<div class="l input-groups">
					<label>图片：</label>
					<form id="tf" style="float: left;width: 320px;margin-right: 10px">
						<div class="file-panel">
							<input id="bannerInput" type="text" class="file-input" placeholder="选择图片（图片宽度为1920px，后缀jpg格式）">
							<div class="file-box">
								<input type="file" class="file" id="files" name="image" onchange="fileChange(this)">
							</div>
						</div>
					</form>
					<input type="hidden" id="fileId">
					<button class="btn btn-info pull-left" onclick="uploadImg()" style="margin-top: 3px;">上传图片</button>
				</div>
				<div class="r input-groups">
					<label>图片预览：</label>
					<img src="" id="img" width="320px">
				</div>
				<div class="input-groups btns">
					<button id="confirm-btn" class="btn btn-info pull-right" style="width: 100px;">保存</button>
				</div>
			</div>
		</div>

		<script src="../../files/js/jquery.min.js"></script>
		<script src="../../files/js/bootstrap.js"></script>
		<script src="../../files/layer/layer.js"></script>
		<script src="../../files/js/comment.js"></script>
		<script src="../../files/js/jquery.form.js"></script>
		<script>
			var serailNo;
			var pageType = window.location.href.split("type=")[1];
			var headTxt;
			switch (pageType) {
				case 'technology.accurateCustomer':
					headTxt = "技术与能力-精准获客";
					break;
				case 'technology.digitalRisk':
					headTxt = "技术与能力-数字风控";
					break;
				case 'technology.smartOperation':
					headTxt = "技术与能力-智能运营";
					break;
				case 'technology.productPlatform':
					headTxt = "技术与能力-产品平台";
					break;
				case 'technology.techPlatform':
					headTxt = "技术与能力-科技科台";
					break;
				case 'solution.energize':
					headTxt = "解决方案-数字信贷科技一站式赋能";
					break;
				case 'solution.loanUnite':
					headTxt = "解决方案-数字信贷联合运营";
					break;
				case 'solution.smartRisk':
					headTxt = "解决方案-智能风控";
					break;
				case 'solution.sceneLoan':
					headTxt = "解决方案-场景化信贷";
					break;
			}
			document.getElementById("headTxt").innerHTML = headTxt;
			$(function() {
				getDatas();
			});
			/*保存数据*/
			$('#confirm-btn').click(function() {
				var title = $("#title").val();
				var subTitle = $("#subTitle").val();
				var baseContent = $("#baseContent").val();
				var imgSrc = "";
				if(isEmpty($("#img").attr("src"))) {
					imgSrc = $("#fileId").val();
				} else {
					imgSrc = $("#img").attr("src");
				}
				var pos = {
					title: title,
					subTitle: subTitle,
					baseContent: baseContent,
					imageSrc: imgSrc
				};
				if (checkLength(title) > 40) {
					layer.msg('标题不得超过40个汉字或80个英文');
					return;
				}
				if (checkLength(subTitle) > 40) {
					layer.msg('子标题不得超过40个汉字或80个英文');
					return;
				}
				if(isEmpty(imgSrc)) {
					layer.msg('请上传图片');
					return;
				}
				var url = serailNo ? "/api/DsWebsit/upData.do" : "/api/DsWebsit/addData.do";
				$.ajax({
					type: 'post',
					dataType: 'json',
					url: url,
					data: {
						pos: JSON.stringify(pos),
						type: pageType,
						serailNo: serailNo
					},
					success: function(rtnData) {
						layer.msg(rtnData.message);
					},
					error: function(XMLHttpRequest, textStatus, errorThrown) {
						layer.msg("系统异常，请稍后再试！");
					}
				});

			});

			function checkLength(str) {
				var len = 0;
				for (var i=0; i<str.length; i++) {
					var code = str[i].charCodeAt(0);
					if ((code >= 65 && code <=90) || (code >=97 && code <= 122)) {
						len += 0.5;
					} else {
						len += 1;
					}
				}
				return len;
			}

			function uploadImg() {
				var form = new FormData(document.getElementById("tf"));
				$.ajax({
					url: "/api/uploadImageLocal.do",
					async: false,
					type: "post",
					data: form,
					processData: false, // 告诉jQuery不要去处理发送的数据
					contentType: false, // 告诉jQuery不要去设置Content-Type请求头
					success: function(jsonResult) {
						if(jsonResult.code == "0000") {
							layer.msg("上传成功");
							$("#fileId").val(jsonResult.data);
							$("#img").attr("src", jsonResult.data);
						} else {
							layer.msg("上传失败");
						}
					},
					error: function(XMLHttpRequest, textStatus, errorThrown) {
						layer.msg("系统异常，请稍后再试！");
					}
				});
			}

			/*查询数据*/
			function getDatas() {
				$.ajax({
					type: "POST",
					url: "/api/DsWebsit/getDatas.action",
					data: {
						type: pageType,
						page: 0,
						size: 1
					},
					dataType: "json",
					success: function(jsonResult) {
						if(jsonResult.code == "0000") {
							if (jsonResult.data.list && jsonResult.data.list.length > 0) {
								var item = jsonResult.data.list[0];
								$("#title").val(item.title);
								$("#subTitle").val(item.subTitle);
								$("#baseContent").val(item.baseContent);
								$("#img").attr("src", item.imageSrc);
								serailNo = item.baseNo;
							}
						}
					},
					error: function(XMLHttpRequest, textStatus, errorThrown) {
						layer.msg("系统异常，请稍后再试！");
					}
				});
			}
		</script>
	</body>

</html>