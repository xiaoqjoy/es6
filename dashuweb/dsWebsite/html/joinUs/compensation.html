<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="../../files/css/bootstrap.css">
    <link rel="stylesheet" href="../../files/css/font-awesome.min.css">
    <link rel="stylesheet" href="../../files/css/simple-line-icons.css">
    <link rel="stylesheet" href="../../files/css/app.css">
    <link rel="stylesheet" href="../../files/css/paltstyle.css">
    <title>Title</title>
</head>
<body style="background: none;">
<div class="widget-box bannerBox">
    <div class="widget-title"> <span class="icon"><i class="glyphicon glyphicon-th"></i></span>
        <h5>加入我们-薪酬福利图标、文字编辑</h5>
    </div>
    <div class="widget-content ">
        <div class=" text-right">
        	 <!--     <label style="float:left">提示：请按照官网对应图标位置顺序添加数据</label>-->
	            <button id="add-btn" onclick="add()" class="btn btn-info pull-right">增加</button>
	      <!--        <div >
	            	<label>福利描述：</label>
	                <input id="fontInput" style ="width:300px;margin-right:10px;height:32px" maxlength="17" placeholder="请输入不超过17个字的福利描述 " type="text">
	               
	            </div>-->
         

            <div class="clearfix"></div>
        </div>
        <table class="table data-table table-bordered team-table" style="margin-top:10px">
            <thead>
                <tr>
                    <th>ID号</th>
                    <th>福利描述</th>
                    <th>图片</th>
                    <th>排序号</th>
                    <th>排序操作</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody id="list">
                
                
            </tbody>
        </table>

        <div class="text-right">
            <ul class="pagination pagination-sm">

            </ul>
        </div>
	<div class="layui-layer layui-anim layui-layer-page " id="layui-layer-alert" type="page" style="display: none; z-index: 15; width: 900px; height: 400px; left: 50%; top: 50%; margin-left: -470px; margin-top: -250px; overflow-y: auto;">
			<div class="form-horizontal edit-block">
				<div class="input-groups">
					<label>图片：</label>
					<div>
						<img src="" class="edit-block-img" id="image">
						<div class="operation ">
							<button id="uploadBtn" class="btn btn-info pull-right">上传</button>
							<form id="tf">
							<div class="file-panel">
								<input id="bannerInput" type="text" class="file-input" disabled placeholder="选择图片（图片宽度为38*38px,后缀jpg格式）">
								<div class="file-box">
									<input type="file" class="file" id="files" name="image" onchange="fileChange(this)">
								</div>
							</div>
							</form>
						</div>
					</div>
				</div>
				<div class="input-groups">
					<label>福利描述：</label> <input type="text" id="textDesc" maxlength="17" placeholder="请输入不超过17个字的福利描述 " >
				</div>
				<div class="input-groups">
					<input type="hidden" class="cno_input">
				</div>
				<div class="input-groups btns">
					<button id="confirm-btn" class="btn btn-info pull-right" onclick="saveData()">提交</button>
					 <button id="close-btn" onclick="closeDiv()" class="btn btn-default pull-right">关闭</button>
				</div>
			</div>
		</div>
    </div>

</div>

<script src="../../files/js/jquery.min.js"></script>
<script src="../../files/js/bootstrap.js"></script>
<script src="../../files/layer/layer.js"></script>
<script src="../../files/js/comment.js"></script>
<script>
	
	//加载
    $(function(){
		getDatas();
		
    });
    
    
    //修改
	$(document).on('click','.eb',function(){
		$('.edit-block .edit-block-img').attr('src', $(this).parents('tr').find('.leader-img').attr('src'));
		$('#bannerInput').val('选择图片（图片宽度为50px,后缀jpg格式）');
		$('#textDesc').val($(this).parents('tr').find('.textDesc').text());
		$('.edit-block .cno_input').val($(this).parents('tr').find('.id-num').text());
		$('#layui-layer-alert').show();
	});
    
    
    //新增
	function add(){
		$('.edit-block .edit-block-img').attr('src','');
		$('#textDesc').val('');
		$('.edit-block .cno_input').val('');
		$('#bannerInput').val('选择图片（图片宽度为50px,后缀jpg格式）');
		$("#layui-layer-alert").show();
	}
	
	//关闭弹框
	 function closeDiv(){
	      	$('#layui-layer-alert').hide();
	 }
	
	//保存
	function saveData(){
		var imageSrc = $('.edit-block .edit-block-img').attr('src');
		var textDesc = $('#textDesc').val();
		var cSerailNo = $('.cno_input').val();
		
		if(isEmpty(imageSrc)){
			layer.msg("请上传图片！");
			return false;
		}
		if(isEmpty(textDesc)){
			layer.msg("请输入福利描述！");
			return false;
		}
		var pos ={'status' : '2', 'imageSrc' : imageSrc, 'textDesc' : textDesc};
		if (!isEmpty(cSerailNo)) {
			cUpData(pos, cSerailNo);
		} else {
			cAddData(pos);
		} 
	}
	
     //删除banner(二期需求变更后 我保留下来的 不需要可以删除)
     function deleteBanner(othis) {
        var id = $(othis).parents('tr').find('.id-num').text();
        layer.confirm('确定删除id为"'+ id +'"的福利图标及描述吗？',{
            btn:['Y','N']
        },function(){
        	delData(id);
        })
    }  
    
     
 	//上传图片
 	$(document).on( 'click', '#uploadBtn', function() {
 		var form = new FormData(document.getElementById("tf"));
 		$.ajax({
 			url : "/api/uploadImageLocal.do",
 			type : "POST",
 			data : form,
 			processData : false, // 告诉jQuery不要去处理发送的数据
 			contentType : false, // 告诉jQuery不要去设置Content-Type请求头
 			success : function(jsonResult) {
 				if (!isEmpty(jsonResult) && jsonResult.code == '0000') {
 					$(".edit-block-img").attr("src", jsonResult.data);
 				}
 			},
 			error : function(XMLHttpRequest, textStatus, errorThrown) {
 				layer.msg("系统异常，请稍后再试！");
 			}
 		});
 	});
     
     //弹出修改弹框
     function updateBanner(othis) {
    	   var textDesc = $(othis).parents('tr').find('.textDesc').text();
    	   var textDesc = $(othis).parents('tr').find('.textDesc').text();
    	   var id=$(othis).parents('tr').find('.id-num').text();
    	   
           layer.open({
               type: 1,
               title: false,
               closeBtn: 0,
               area: ['700px', '300px'],
               shadeClose: true,
               content: editHtml
           });
           $("#textDesc").val(textDesc);
           $("#imageSrc").attr("src", imageSrc);
           $("#base_no").val(id);
    }  
     
     
     
     
 	function cAddData(pos){
		$.ajax({
			type : "POST",
			url : "/api/DsWebsit/addData.do",
			dataType : "json",
			data : {
				"pos" : JSON.stringify(pos),
				type : 'join.compensation'
			},
			success : function(jsonResult) {
				layer.msg(jsonResult.message);
				$('#layui-layer-alert').hide();
				getDatas();
			},
			error : function(XMLHttpRequest, textStatus, errorThrown) {
				layer.msg("系统异常，请稍后再试！");
			}
		});
	}
	
	function cUpData(pos, cSerailNo){
		$.ajax({
			type : "POST",
			url : "/api/DsWebsit/upData.do",
			dataType : "json",
			data : {
				"pos" : JSON.stringify(pos),
				type : 'join.compensation',
				serailNo : cSerailNo
			},
			success : function(jsonResult) {
				layer.msg(jsonResult.message);
				$('#layui-layer-alert').hide();
				getDatas();
			},
			error : function(XMLHttpRequest, textStatus, errorThrown) {
				layer.msg("系统异常，请稍后再试！");
			}
		});
	}

  
    
    function sortDown(othis){
    	if($(othis).hasClass('disable')){
            return ;
        }else{
        	var onNum =  $(othis).parents('tr').find('.id-num').text();
            setSorting(onNum,"down");
        }
    }
    
    function sortUp(othis){
    	if($(othis).hasClass('disable')){
            return ;
        }else{
            var onNum =   $(othis).parents('tr').find('.id-num').text();
            setSorting(onNum,"up");
        }
    }

    function setSorting(sSerialNo,flag){
    	$.ajax({
			type : "POST",
			url : "/api/DsWebsit/sortData.do",
			dataType : "json",
			data : {
				type : 'join.compensation',
				serailNo : sSerialNo,
				flag : flag
			},
			success : function(jsonResult) {
				layer.msg(jsonResult.message);
				getDatas();
			},
			error: function(XMLHttpRequest, textStatus, errorThrown) {
				layer.msg("系统异常，请稍后再试！");
            }
		});
    }
      
    
   function getDatas(){
	    $.ajax({  
	        type: "POST",  
	        url: "/api/DsWebsit/getDatas.do",  
	        data:{
	        	type : "join.compensation",
	        	page : "0",
	        	size : "6"
	        },
	        dataType: "json",
	        success: function (jsonResult) {
	        	if(jsonResult.code=="0000" && jsonResult.data.length>0){
	        		$("#list").empty();
	        		$.each(jsonResult.data, function(i,val){
	        			if(i==0){
	        				$("#list").append("<tr><td><span class='id-num'>"+val.baseNo+"</span></td><td><span class='textDesc'>"+val.textDesc+"</span></td><td><img src='" + val.imageSrc + "' class='leader-img'></td>"+
		        					"<td><span class='sortIndex'>"+val.sortIndex+"</span></td><td><a class='sort-up sort  disable ' href='javascript:void(0)' onclick='sortUp(this)'><i class='glyphicon glyphicon-arrow-up'></i></a><a class='sort-down sort ' href='javascript:void(0)' onclick='sortDown(this)'><i class='glyphicon glyphicon-arrow-down'></i></a></td><td><a class='edit-btn eb' href='javascript:void(0)'>编辑</a><a class='delete-btn' href='javascript:void(0)' onclick='deleteBanner(this)'>删除</a></td></tr>");
	        			} else if(i>0 && i==jsonResult.data.length-1){
	        				$("#list").append("<tr><td><span class='id-num'>"+val.baseNo+"</span></td><td><span class='textDesc'>"+val.textDesc+"</span></td><td><img src='" + val.imageSrc + "' class='leader-img'></td>"+
		        					"<td><span class='sortIndex'>"+val.sortIndex+"</span></td><td><a class='sort-up sort  ' href='javascript:void(0)' onclick='sortUp(this)'><i class='glyphicon glyphicon-arrow-up'></i></a><a class='sort-down sort  disable ' href='javascript:void(0)' onclick='sortDown(this)'><i class='glyphicon glyphicon-arrow-down'></i></a></td><td><a class='edit-btn eb' href='javascript:void(0)'>编辑</a><a class='delete-btn' href='javascript:void(0)' onclick='deleteBanner(this)'>删除</a></td></tr>");
	        			}else{
	        				$("#list").append("<tr><td><span class='id-num'>"+val.baseNo+"</span></td><td><span class='textDesc'>"+val.textDesc+"</span></td><td><img src='" + val.imageSrc + "' class='leader-img'></td>"+
		        					"<td><span class='sortIndex'>"+val.sortIndex+"</span></td><td><a class='sort-up sort ' href='javascript:void(0)' onclick='sortUp(this)'><i class='glyphicon glyphicon-arrow-up'></i></a><a class='sort-down sort ' href='javascript:void(0)' onclick='sortDown(this)'><i class='glyphicon glyphicon-arrow-down'></i></a></td><td><a class='edit-btn eb' href='javascript:void(0)'>编辑</a><a class='delete-btn' href='javascript:void(0)' onclick='deleteBanner(this)'>删除</a></td></tr>");
	        			}
	        		});
	        		if(jsonResult.data.length>=6){	        		 
	        			$("#add-btn").attr("disabled","disabled");
	        			$("#add-btn").attr("style","background:#ccc;border:none");
	        		}else{
	        			$("#add-btn").attr("disabled",false);
	        			$("#add-btn").attr("style","");
	        		}
	        	} else {
	        		$("#list").html("");
	        	}
	        },
	        error: function(XMLHttpRequest, textStatus, errorThrown) {
				layer.msg("系统异常，请稍后再试！");
            }
	    });   
	}
    
    function delData(id){
    	$.ajax({  
	        type: "POST",  
	        url: "/api/DsWebsit/delData.do",  
	        data:{
	        	type : "join.compensation",
	        	serailNo : id
	        },
	        dataType: "json",
	        success: function (jsonResult) {
	        	if(jsonResult.code=="0000"){
	        		layer.msg(jsonResult.message);
	        		getDatas();
	        	} else {
	        		layer.msg('删除失败');
	        	}
	        },
	        error: function(XMLHttpRequest, textStatus, errorThrown) {
				layer.msg("系统异常，请稍后再试！");
            }
	    });   
    }
    
    

</script>
</body>
</html>