<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="../../files/css/bootstrap.css">
    <link rel="stylesheet" href="../../files/css/font-awesome.min.css">
    <link rel="stylesheet" href="../../files/css/simple-line-icons.css">
    <link rel="stylesheet" href="../../files/css/app.css">
    <link rel="stylesheet" href="../../files/css/paltstyle.css">
    <title>Title</title>
</head>
<body style="background: none;">

<input type="hidden" id="hidId">
<div class="widget-box bannerBox">
    <div class="widget-title"> <span class="icon"><i class="glyphicon glyphicon-th"></i></span>
        <h5>加入我们-薪酬福利图片编辑</h5>
    </div>
    <div class="widget-content ">
        <div class="operation text-right">
        	 
	        <button id="create-btn" class="btn btn-info pull-right">增加</button>
            <div class="clearfix"></div>
        </div>
        <table class="table data-table table-bordered">
            <thead>
                <tr>
                    <th>ID号</th>
                    <th>图片</th>
                    <th>图片描述</th>  
                    <th>图片链接</th>               
                    <th>排序号</th>
                    <th>排序操作</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody id="list">
                
                
            </tbody>
        </table>

        <div class="text-right">
            <ul class="pagination pagination-sm">

            </ul>
        </div>

    </div>

</div>


<div class="layui-layer-shade" id="layui-layer-shade11" times="1"
				style="display: none; z-index: 14; background-color: #000; opacity: 0.3; filter: alpha(opacity = 30);"></div>
<div class="layui-layer layui-anim layui-layer-page "
				id="layui-layer11" type="page"
				style="display: none; z-index: 15; width: 960px; height: 400px; left: 50%; top: 50%; margin-left: -480px; margin-top: -250px;overflow-y: auto;overflow-x: auto;">
				<div class="layui-layer-content" style="height: 380px;">
				  
			  <div class="form-horizontal" > 
			 
			 	<div class="double-input" style="margin-top:20px">
				 <div class="l input-groups">
			            <label>图片：</label>
			            <form id="tf">
			            <div class="file-panel">
				            <input id="bannerInput" type="text" class="file-input" placeholder="选择图片（图片的尺寸为：270*200px）">
				            <div class="file-box">
				                <input type="file" class="file" id="files" name="image" onchange="fileChange(this)">                              
				            </div>
			            </div>
			            </form>
			            <input type="hidden" id="fileId">
			            <button  class="btn btn-info pull-left" onclick="uploadImg()">上传图片</button>
			        </div>
			         <div class="r input-groups">
			            <label>图片预览：</label>
			             <img src="" id="img" width="250px">
			        </div>
			         </div>
    
			    <div class="l input-groups">
            		<label>图片描述：</label>
            		<input id="txtDesc" type="text" maxlength="16"  placeholder="请输入不超过16个字的图片描述">
        		</div>
        		   <div class="l input-groups">
            		<label>图片链接：</label>
            		<input id="txtLink" type="text"  placeholder="请输入图片链接">
        		</div>

    <div class="input-groups btns">
      <button id="close-btn" onclick="closeDiv()" class="btn btn-default pull-right">关闭</button>
        <button id="confirm-btn" class="btn btn-info pull-right" >确认</button>
       
      
    </div>

</div>
				</div>
				<span class="layui-layer-setwin"></span>
			</div>


<script src="../../files/js/jquery.min.js"></script>
<script src="../../files/js/bootstrap.js"></script>
<script src="../../files/layer/layer.js"></script>
<script src="../../files/js/comment.js"></script>
<script>
    $(function(){    	
		getDatas();
    });
    
    $('#confirm-btn').click(function(){
	  	  var id = $("#hidId").val();
	  	  var desc =  $('#txtDesc').val();
	  	  var link = $("#txtLink").val();
	  	 
	    	  var imgSrc = "";
	    	  if(isEmpty($("#img").attr("src"))){
	    		  imgSrc = $("#fileId").val();
	    	  }else{
	    		  imgSrc = $("#img").attr("src");
	    	  }
	    	  var pos = {'status': status,'imageSrc': imgSrc,'baseContent':desc,'imageLink':link};
	    
	          if(isEmpty(imgSrc)){
	              layer.msg('请上传图片');
	              return;
	          }
	         
	           
	          var url = isEmpty(id)?"/api/DsWebsit/addData.do":"/api/DsWebsit/upData.do";   	        
	         		$.ajax({
	                  type:'post',
	                  dataType:'json',
	                  url : url,
	                  data:{
						pos:JSON.stringify(pos),
	      				type : 'join.benefits',
	      				serailNo : id
	      			}, 
	                  success : function(rtnData){
	                  	layer.msg(rtnData.message);
	                  	if(rtnData.code=="0000"){
	                  		resetDiv();
	                  		closeDiv();
	      	            	getDatas();
	                  	}
	                  },
	       			error: function(XMLHttpRequest, textStatus, errorThrown) {
	      				layer.msg("系统异常，请稍后再试！");
	       			}
	              }); 
	         	
	    });
 
 
    function closeDiv(){  	 
      	$('#layui-layer-shade11').hide();
      	$('#layui-layer11').hide();
    }
    $('#create-btn').click(function () {
    	resetDiv();
  	  	$('#layui-layer-shade11').show();
        $('#layui-layer11').show();         
  	});
    
    function resetDiv(){
    	$("#hidId").val("");
    	$('#txtDesc').val("");
     
    	$("#fileId").val("");
    	$("#img").attr("src","");
    	$("#bannerInput").val("");
    	$("#files").val("");
    	$("#txtLink").val("");
    }
    
    //删除banner
    function deleteBanner(othis) {
        var id = $(othis).parents('tr').find('.id-num').text();
        layer.confirm('确定删除id为"'+ id +'"的图片吗？',{
            btn:['Y','N']
        },function(){
        	delData(id);
        })
    }
    
    function sortDown(othis){
    	if($(othis).hasClass('disable')){
            return ;
        }else{
        	var onNum =  $(othis).parents('tr').find('.id-num').text();
            setSorting(onNum,"down");
        }
    }
    
    function sortUp(othis){
    	if($(othis).hasClass('disable')){
            return ;
        }else{
            var onNum =   $(othis).parents('tr').find('.id-num').text();
            setSorting(onNum,"up");
        }
    }

    function setSorting(sSerialNo,flag){
    	$.ajax({
			type : "POST",
			url : "/api/DsWebsit/sortData.do",
			dataType : "json",
			data : {
				type : 'join.benefits',
				serailNo : sSerialNo,
				flag : flag
			},
			success : function(jsonResult) {
				layer.msg(jsonResult.message);
				getDatas();
			},
			error: function(XMLHttpRequest, textStatus, errorThrown) {
				layer.msg("系统异常，请稍后再试！");
            }
		});
    }
    
	 function uploadImg(){
		var form = new FormData(document.getElementById("tf"));
		$.ajax({
		    url:"/api/uploadImageLocal.do",
		    async: false,
		    type:"post",
		    data: form,
		    processData: false,  // 告诉jQuery不要去处理发送的数据
		    contentType: false,  // 告诉jQuery不要去设置Content-Type请求头
		    success:function(jsonResult){
		    	if(jsonResult.code == "0000"){
		    		layer.msg("上传成功");
		    		$("#fileId").val(jsonResult.data);	
		    		$("#img").attr("src",jsonResult.data); 
		    	} else {
		    		layer.msg("上传失败");
		    	}
 			},
 			error: function(XMLHttpRequest, textStatus, errorThrown) {
				layer.msg("系统异常，请稍后再试！");
          }
		});
	}
    
    function addData(pos){
    	$.ajax({
			type : "POST",
			url : "/api/DsWebsit/addData.do",
			dataType : "json",
			data : {
				"pos":JSON.stringify(pos),
				type : 'join.benefits'
			},
			success : function(jsonResult) {
				 getDatas();
				 closeDiv();
				layer.msg(jsonResult.message);
			},
			error: function(XMLHttpRequest, textStatus, errorThrown) {
				layer.msg("系统异常，请稍后再试！");
            }
		});
    }	
    
    function getDatas(){
	    $.ajax({  
	        type: "POST",  
	        url: "/api/DsWebsit/getDatas.do",  
	        data:{
	        	type : "join.benefits",
	        	page : "0",
	        	size : "10"
	        },
	        dataType: "json",
	        success: function (jsonResult) {
	        	if(jsonResult.code=="0000" && jsonResult.data.length>0){
	        		$("#list").empty();
	        		$.each(jsonResult.data, function(i,val){
	        			 
	        			var desc = isEmpty(val.baseContent)?"": val.baseContent;
	        			 var link = isEmpty(val.imageLink)?"": val.imageLink;
	        			if(i==0){
	        				$("#list").append("<tr><td><span class='id-num'>"+val.baseNo+"</span></td><td><img src='"+val.imageSrc+"' class='banners'></td><td>"+desc+"</td><td>"+link+"</td>"+	        						
		        					"<td><span class='sortIndex'>"+val.sortIndex+"</span></td><td><a class='sort-up sort  disable ' href='javascript:void(0)' onclick='sortUp(this)'><i class='glyphicon glyphicon-arrow-up'></i></a><a class='sort-down sort ' href='javascript:void(0)' onclick='sortDown(this)'><i class='glyphicon glyphicon-arrow-down'></i></a></td><td><a class='edit-btn' href='javascript:void(0)' onclick='editBanner(this)'>编辑</a><a class='delete-btn' href='javascript:void(0)' onclick='deleteBanner(this)'>删除</a></td></tr>");
	        			} else if(i>0 && i==jsonResult.data.length-1){
	        				$("#list").append("<tr><td><span class='id-num'>"+val.baseNo+"</span></td><td><img src='"+val.imageSrc+"' class='banners'></td><td>"+desc+"</td><td>"+link+"</td>"+
		        					"<td><span class='sortIndex'>"+val.sortIndex+"</span></td><td><a class='sort-up sort  ' href='javascript:void(0)' onclick='sortUp(this)'><i class='glyphicon glyphicon-arrow-up'></i></a><a class='sort-down sort  disable ' href='javascript:void(0)' onclick='sortDown(this)'><i class='glyphicon glyphicon-arrow-down'></i></a></td><td><a class='edit-btn' href='javascript:void(0)' onclick='editBanner(this)'>编辑</a><a class='delete-btn' href='javascript:void(0)' onclick='deleteBanner(this)'>删除</a></td></tr>");
	        			}else{
	        				$("#list").append("<tr><td><span class='id-num'>"+val.baseNo+"</span></td><td><img src='"+val.imageSrc+"' class='banners'></td><td>"+desc+"</td><td>"+link+"</td>"+
		        					"<td><span class='sortIndex'>"+val.sortIndex+"</span></td><td><a class='sort-up sort ' href='javascript:void(0)' onclick='sortUp(this)'><i class='glyphicon glyphicon-arrow-up'></i></a><a class='sort-down sort ' href='javascript:void(0)' onclick='sortDown(this)'><i class='glyphicon glyphicon-arrow-down'></i></a></td><td><a class='edit-btn' href='javascript:void(0)' onclick='editBanner(this)'>编辑</a><a class='delete-btn' href='javascript:void(0)' onclick='deleteBanner(this)'>删除</a></td></tr>");
	        			}
	        		});
	        		 if(jsonResult.data.length>=10){	        		 
		        			$("#create-btn").attr("disabled","disabled");
		        			$("#create-btn").attr("style","background:#ccc;border:none");
		        		}else{
		        			$("#create-btn").attr("disabled",false);
		        			$("#create-btn").attr("style","");
		        		}
	        	} else {
	        		$("#list").html("");
	        	}
	        },
	        error: function(XMLHttpRequest, textStatus, errorThrown) {
				layer.msg("系统异常，请稍后再试！");
            }
	    });   
	}
    
   
    
    function editBanner(othis){
    	var id = $(othis).parents('tr').find('.id-num').text();
    	$.ajax({  
	        type: "POST",  
	        url: "/api/DsWebsit/getData.do",  
	        data:{
	        	type : "join.benefits",
	        	serailNo : id
	        },
	        dataType: "json",
	        success: function (jsonResult) {
	        	if(jsonResult.code=="0000"){	        		
	        		 $("#hidId").val(id);
	        	  	 $('#txtDesc').val(jsonResult.data.baseContent);
	        	  
	        	  	 $("#img").attr("src",jsonResult.data.imageSrc);
	        	 	$('#layui-layer-shade11').show();
	                $('#layui-layer11').show();   
	        	} else {
	        		layer.msg('获取数据失败');
	        	}
	        },
	        error: function(XMLHttpRequest, textStatus, errorThrown) {
				layer.msg("系统异常，请稍后再试！");
            }
	    });   
    }
    function delData(id){
    	$.ajax({  
	        type: "POST",  
	        url: "/api/DsWebsit/delData.do",  
	        data:{
	        	type : "join.benefits",
	        	serailNo : id
	        },
	        dataType: "json",
	        success: function (jsonResult) {
	        	if(jsonResult.code=="0000"){
	        		layer.msg(jsonResult.message);
	        		getDatas();
	        	} else {
	        		layer.msg('删除失败');
	        	}
	        },
	        error: function(XMLHttpRequest, textStatus, errorThrown) {
				layer.msg("系统异常，请稍后再试！");
            }
	    });   
    }
    
    
    

</script>
</body>
</html>